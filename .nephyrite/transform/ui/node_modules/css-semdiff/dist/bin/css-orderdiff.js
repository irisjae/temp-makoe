#! /usr/bin/env node
"use strict";
var commander = require("commander");
var order_diff_1 = require("../order_diff");
var cli_utils_1 = require("../cli_utils");
var order_diff_2 = require("../format/order_diff");
var error_utils_1 = require("../error_utils");
var StatusCode;
(function (StatusCode) {
    StatusCode[StatusCode["NOT_CHANGED"] = 0] = "NOT_CHANGED";
    StatusCode[StatusCode["ERROR"] = 1] = "ERROR";
    StatusCode[StatusCode["CHANGED"] = 2] = "CHANGED";
})(StatusCode || (StatusCode = {}));
var cli = commander
    .version(cli_utils_1.getVersion())
    .usage("[options] <file ...>")
    .option("-V, --verbose", "Display verbose diff")
    .parse(process.argv);
function runOrderDiff(styleSheets, options) {
    return styleSheets
        .then(function (tuple) { return order_diff_1.orderDiff(tuple[0], tuple[1]); })
        .then(function (result) {
        console.log(options.verbose
            ? order_diff_2.formatOrderDiffResultVerbose(result)
            : order_diff_2.formatOrderDiffResult(result));
        var changedSelectors = Object.keys(result);
        return changedSelectors.length > 0
            ? StatusCode.CHANGED
            : StatusCode.NOT_CHANGED;
    })
        .catch(function (errorLike) {
        console.error("Error: " + error_utils_1.stringifyErrorLike(errorLike));
        return StatusCode.ERROR;
    })
        .then(function (statusCode) {
        process.exitCode = statusCode;
    });
}
runOrderDiff(cli_utils_1.getStyleSheetPair(cli.args), {
    verbose: cli.opts().verbose,
});
