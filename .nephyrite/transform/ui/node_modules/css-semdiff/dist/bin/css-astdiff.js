#! /usr/bin/env node
"use strict";
var commander = require("commander");
var ast_diff_1 = require("../ast_diff");
var cli_utils_1 = require("../cli_utils");
var ast_diff_2 = require("../format/ast_diff");
var error_utils_1 = require("../error_utils");
var StatusCode;
(function (StatusCode) {
    StatusCode[StatusCode["NOT_CHANGED"] = 0] = "NOT_CHANGED";
    StatusCode[StatusCode["ERROR"] = 1] = "ERROR";
    StatusCode[StatusCode["CHANGED"] = 2] = "CHANGED";
})(StatusCode || (StatusCode = {}));
var cli = commander
    .version(cli_utils_1.getVersion())
    .usage("[options] <file ...>")
    .option("-V, --verbose", "Display verbose diff")
    .parse(process.argv);
function runAstDiff(styleSheets, options) {
    return styleSheets
        .then(function (tuple) { return ast_diff_1.astDiff(tuple[0], tuple[1]); })
        .then(function (result) {
        var changed = result.changed;
        console.log(options.verbose
            ? ast_diff_2.formatAstDiffResultVerbose(result)
            : ast_diff_2.formatAstDiffResult(result));
        return changed
            ? StatusCode.CHANGED
            : StatusCode.NOT_CHANGED;
    })
        .catch(function (errorLike) {
        console.error("Error: " + error_utils_1.stringifyErrorLike(errorLike));
        return StatusCode.ERROR;
    })
        .then(function (statusCode) {
        process.exitCode = statusCode;
    });
}
runAstDiff(cli_utils_1.getStyleSheetPair(cli.args), {
    verbose: cli.opts().verbose,
});
